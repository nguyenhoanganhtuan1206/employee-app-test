name: Build

on:
  push:
    branches:
      - feature/integrate-sonar


jobs:
  build:
    name: Build
    runs-on: [self-hosted, owt]
    steps:
        - run: |
            export SONAR_SCANNER_VERSION=10.2
            export SONAR_TOKEN=squ_2dd6380983961e1c5b983c048d242d495472b4b8
            export SONAR_SCANNER_HOME=$HOME/.sonar/sonar-scanner-$SONAR_SCANNER_VERSION-linux
            curl --create-dirs -sSLo $HOME/.sonar/sonar-scanner.zip https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-$SONAR_SCANNER_VERSION-linux.zip
            unzip -o $HOME/.sonar/sonar-scanner.zip -d $HOME/.sonar/
            export PATH=$SONAR_SCANNER_HOME/bin:$PATH
            export SONAR_SCANNER_OPTS="-server"
            sonar-scanner \
            -Dsonar.projectKey=employee-app-test \
            -Dsonar.projectName=EmployeeAppTest \
            -Dsonar.login=squ_2dd6380983961e1c5b983c048d242d495472b4b8 \
            -Dsonar.sources=. \ 
            -Dsonar.host.url=http://192.168.1.2:9000 \
            -Dsonar.verbose=true
          name: Install Sonarqube